# Workflow Logs Page Documentation

## Overview
The Workflow Logs Page is a new admin interface added in version 1.6.0 that provides comprehensive visibility into the Omeda deployment workflow execution. This page centralizes all workflow logging information, making debugging and monitoring much easier.

## Location
**Admin Menu Path:** Omeda Integration â†’ Workflow Logs  
**Direct URL:** `/wp-admin/admin.php?page=omeda-workflow-logs`

## Features

### Main Logs List
The main page displays a paginated table of all posts that have workflow logs:

- **Post ID**: WordPress post ID
- **Title**: Post title
- **Type**: Post type (post, ngl_pattern, etc.)
- **Status**: Current post status (draft, publish, scheduled, etc.)
- **Last Modified**: When the post was last updated
- **Actions**: 
  - "View Logs" button - Opens detailed log view
  - "Edit Post" button - Opens post editor

### Pagination
- Shows 20 posts per page
- Standard WordPress pagination controls
- Only displays posts that have workflow logs

### Detailed Log View
Click "View Logs" on any post to see:

1. **Post Information**
   - Post ID
   - Post title
   - Current workflow state
   - Omeda deployment ID (TrackID)

2. **Log Entries Table**
   - **Timestamp**: When the log entry was created
   - **Level**: Log severity (INFO, WARN, ERROR)
   - **Message**: Descriptive message about the workflow step
   - **Context**: Additional data (API responses, errors, etc.)

3. **Visual Features**
   - Color-coded log levels:
     - ERROR: Red background
     - WARN: Yellow background
     - INFO: Green background
   - Logs sorted by most recent first
   - Context data displayed in readable format
   - Back button to return to main logs list

## Use Cases

### 1. Debugging Failed Deployments
If a deployment fails:
1. Go to Workflow Logs page
2. Find the post in the list
3. Click "View Logs"
4. Look for ERROR level entries
5. Check context for API error messages
6. Identify the specific step that failed

### 2. Monitoring Active Workflows
To see what's currently happening:
1. Check the main logs list
2. Look at "Last Modified" times
3. Click "View Logs" on recent posts
4. See the progression through the 5-step workflow
5. Verify current workflow state

### 3. Troubleshooting Omeda API Issues
When API calls aren't working:
1. Find the affected post
2. View detailed logs
3. Look for API request/response context
4. Check deployment ID creation
5. Verify audience assignment and content upload

### 4. Verifying Content Submission
To confirm content was sent correctly:
1. Find the post in logs
2. Check for "Step 3/5: Content uploaded" message
3. Look for WARN messages about content issues
4. Verify subject format was parsed correctly

## Technical Implementation

### Database Queries
The page uses direct SQL queries for efficiency:

```sql
-- Get posts with logs
SELECT DISTINCT p.ID, p.post_title, p.post_type, p.post_status, p.post_modified
FROM wp_posts p
INNER JOIN wp_postmeta pm ON p.ID = pm.post_id
WHERE pm.meta_key = '_omeda_workflow_log'
ORDER BY p.post_modified DESC
LIMIT 20 OFFSET 0
```

### Post Meta Keys Used
- `_omeda_workflow_log` - Array of JSON-encoded log entries
- `_omeda_workflow_state` - Current state (created, audience_assigned, etc.)
- `_omeda_deployment_id` - Omeda TrackID

### Log Entry Structure
Each log entry is stored as JSON:

```json
{
  "timestamp": "2025-10-29 18:42:15",
  "level": "INFO",
  "message": "Step 1/5: Deployment created with ID 12345",
  "context": {
    "deployment_id": 12345,
    "api_response": {...}
  }
}
```

### Access Control
- Requires `manage_options` capability
- Only administrators can access
- Returns WordPress error if unauthorized

## Integration with Workflow Manager

The logs page displays data generated by the `Omeda_Workflow_Manager` class:

### Log Levels
- **INFO**: Normal workflow progression
- **WARN**: Non-critical issues (e.g., missing optional data)
- **ERROR**: Critical failures requiring attention

### Workflow States Tracked
1. `created` - Deployment created in Omeda
2. `audience_assigned` - Audience query assigned
3. `content_uploaded` - HTML/subject sent to Omeda
4. `test_sent` - Test email dispatched
5. `scheduled` - Final deployment scheduled

## Comparison with Other Logging Methods

### vs. Debug.log
**Workflow Logs Page Advantages:**
- User-friendly interface
- Organized by post
- Filterable and searchable
- No file system access needed
- Structured data display

**Debug.log Advantages:**
- All PHP errors and warnings
- System-level debugging
- Raw error traces

### vs. Database Queries
**Workflow Logs Page Advantages:**
- No SQL knowledge required
- Pretty formatting
- Quick access
- Pagination

**Direct Database Advantages:**
- Custom queries possible
- Bulk operations
- Data export

### vs. Action Scheduler
**Workflow Logs Page Advantages:**
- Workflow-specific information
- Post-centric view
- Success logging (not just failures)
- Context from API responses

**Action Scheduler Advantages:**
- Task queue visibility
- Retry attempts
- System-wide job monitoring

## Best Practices

### For Administrators
1. Check logs after major changes
2. Monitor ERROR level entries regularly
3. Keep an eye on recent deployments
4. Use Edit Post links to quickly fix issues

### For Developers
1. Log meaningful context data
2. Use appropriate log levels
3. Include API responses in context
4. Add step numbers to workflow messages

### For Troubleshooting
1. Start with ERROR entries
2. Check the workflow state
3. Verify deployment ID exists
4. Look at full context data
5. Compare timestamps with expected behavior

## Future Enhancements

Potential improvements for future versions:

1. **Filtering**
   - Filter by log level
   - Filter by workflow state
   - Filter by date range
   - Filter by post type

2. **Search**
   - Search log messages
   - Search context data
   - Search by deployment ID

3. **Export**
   - Export logs to CSV
   - Download log data
   - Email log reports

4. **Real-time Updates**
   - Auto-refresh active workflows
   - AJAX updates for recent logs
   - WebSocket notifications

5. **Analytics**
   - Success/failure rates
   - Average workflow duration
   - Common error patterns
   - Deployment trends

## Related Documentation
- [CHANGELOG.md](../CHANGELOG.md) - Version history
- [class-omeda-workflow-manager.php](../src/omeda-newsletter-connector/includes/class-omeda-workflow-manager.php) - Workflow implementation
- [class-omeda-settings.php](../src/omeda-newsletter-connector/includes/class-omeda-settings.php) - Settings and admin pages

## Support
If logs are not appearing:
1. Verify API credentials are configured
2. Check that deployment types exist
3. Ensure post has been saved as draft
4. Confirm workflow manager is initialized
5. Check WordPress debug.log for PHP errors

---

**Version:** 1.6.0  
**Added:** 2025-10-29  
**Author:** Josh Stogner
