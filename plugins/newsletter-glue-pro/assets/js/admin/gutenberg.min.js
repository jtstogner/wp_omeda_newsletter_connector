jQuery.fn.selectText=function(){var t=this[0];if(document.body.createTextRange){var e=document.body.createTextRange();e.moveToElementText(t),e.select()}else if(window.getSelection){var a=window.getSelection(),e=document.createRange();e.selectNodeContents(t),a.removeAllRanges(),a.addRange(e)}},function(t){"use strict";function e(e,a,l){e.find(".ngl-article-featured img").prop("src");var n={action:"newsletterglue_save_article_image",key:a,ids:l,security:newsletterglue_params.ajaxnonce};t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:n,success:function(t){t?(e.find(".ngl-article-featured img").prop("src",t.data.url),e.attr("data-attachment",t.data.id),e.find(".ngl-article-featured-edit i.trash").show()):(e.find(".ngl-article-featured img").prop("src",e.find(".ngl-article-featured img").attr("data-original-src")),e.attr("data-attachment",""),e.find(".ngl-article-featured-edit i.trash").hide())}})}function a(e,a=0){e.find(".ngl-articles-wrap .ngl-article:visible").each(function(){var a=e.find(".ngl-article:visible"),l=a.length-a.index(t(this));t(this).attr("data-key",l)});var l=e.attr("data-block-id"),n=[],i=[];e.find(".ngl-article").each(function(){var e=t(this).attr("data-key"),a=t(this).attr("data-post-id");n.push(e),i.push(a)});var r="action=newsletterglue_ajax_order_articles&security="+newsletterglue_params.ajaxnonce+"&block_id="+l+"&keys="+n+"&values="+i+"&is_dup="+a;t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:r})}function l(e){var a=e.parents(".ngl-embed").find(".ngl-embed-content"),l=e.parents(".ngl-embed").attr("data-block-id"),n=e.val(),i="action=newsletterglue_ajax_get_embed&security="+newsletterglue_params.ajaxnonce+"&block_id="+l+"&url="+encodeURIComponent(n);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:i,beforeSend:function(){a.empty()},success:function(t){t.error&&a.html('<div class="ngl-embed-error">'+t.error+"</div>"),t.html&&a.html(t.html)}})}t(document).on("click",".ngl-article-featured a",function(t){return t.preventDefault(),!1}),t(document).on("mouseenter",".ngl-article-featured",function(){var e=t(this).find(".ngl-article-featured-edit"),a=t(this).find("img");a.attr("src")==a.attr("data-original-src")?e.find("i.trash").hide():e.find("i.trash").show()}),t(document).on("click",".ngl-article-featured-edit i.image.icon",function(a){var l,n;return a.preventDefault(),l=t(this).parents(".ngl-article"),n&&n.open(),(n=wp.media({title:newsletterglue_params.select_image,multiple:!1,library:{type:"image"}})).on("close",function(){var t=n.state().get("selection"),a=[],i=0;t.each(function(t){a[i]=t.id,i++});var r=a.join(",");l.attr("data-attachment",r),e(l,l.attr("data-post-id"),r)}),n.on("open",function(){var t=n.state().get("selection"),e=l.attr("data-attachment")?l.attr("data-attachment").split(","):"";e&&e.forEach(function(e){if(e){var a=wp.media.attachment(e);a.fetch(),t.add(a?[a]:[])}})}),n.open(),!1}),t(document).on("click",".ngl-article-featured-edit i.trash.icon",function(a){return a.preventDefault(),e(t(this).parents(".ngl-article"),t(this).parents(".ngl-article").attr("data-post-id"),""),!1}),t(document).on("change","#ngl_embed_url",function(e){l(t(this))}),t(document).on("keyup","#ngl_embed_url",function(e){("Enter"===e.key||13===e.keyCode)&&l(t(this))}),t(".ngl-embed-url").length&&setInterval(function(){t(".ngl-embed-url").each(function(){var e=t(this),a=t(this).parents(".ngl-embed").find(".ngl-embed-content"),l=t(this).parents(".ngl-embed").find(".ngl-embed-error");""==e.val()||l.length||t.trim(a.html()).length||e.trigger("change")})},500),t(document).on("click",".ngl-article-add button",function(e){return e.preventDefault(),function e(a){var l=a.attr("data-block-id"),n=a.attr("data-date_format"),i=a.find(".ngl_article_s").attr("data-post"),r=a.find(".ngl-article-placeholder");i||(i=a.find(".ngl_article_s").val());var s=a.find(".ngl-articles-wrap");if(s.find(".ngl-article").length)var c=parseInt(s.find(".ngl-article").first().attr("data-key"))+1;else var c=1;var d="action=newsletterglue_ajax_add_article&security="+newsletterglue_params.ajaxnonce+"&block_id="+l+"&key="+c+"&thepost="+encodeURIComponent(i)+"&date_format="+encodeURIComponent(n);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:d,beforeSend:function(){a.find(".ngl-articles-add .ngl-article-status").removeClass("ngl-article-error ngl-article-success").empty()},success:function(t){if(t.error&&(a.find(".ngl-articles-add .ngl-article-status").addClass("ngl-article-error").html(t.error),a.find(".ngl_article_s").focus()),t.key){a.find(".ngl-articles-add .ngl-article-status").addClass("ngl-article-success").html(t.success),a.find(".ngl_article_s").val("").attr("data-post","");var e=r.clone();e.html(e.html().replace("{excerpt}",t.excerpt)),e.html(e.html().replace("{labels}",t.labels)),e.html(e.html().replace("{title}",t.title)),e.html(e.html().replace("{permalink}",t.permalink)),e.html(e.html().replace("{date}",t.date)),e.html(e.html().replace("{featured_image}",t.featured_image)),e.attr("data-post-id",t.post_id),e.attr("data-key",t.key),e.find(".ngl-article-featured a").attr("href",t.permalink),e.find(".ngl-article-featured img").attr("data-original-src",t.featured_image),e.prependTo(a.find(".ngl-articles-wrap")).removeClass("ngl-article-placeholder"),a.find(".ngl-article-list-empty").length&&a.find(".ngl-article-list-empty").hide(),a.find(".ngl-article-list-wrap").prepend(t.item),a.find(".ngl-article-list-empty").remove()}}})}(t(this).parents(".ngl-articles")),!1}),t(document).on("focus",".ngl-article-labels[contenteditable]",function(){let e=t(this);e.data("before",e.html()),e.html()==newsletterglue_params.write_labels&&e.html("")}).on("blur keyup paste input",".ngl-article-labels[contenteditable]",function(){let e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}).on("blur",".ngl-article-labels[contenteditable]",function(){let e=t(this);""==e.html()&&e.html(newsletterglue_params.write_labels)}),t(document).on("change",".ngl-article-labels[contenteditable]",function(){var e=t(this).parents(".ngl-article").attr("data-post-id"),a=t(this).html(),l="action=newsletterglue_ajax_update_labels&security="+newsletterglue_params.ajaxnonce+"&post_id="+e+"&labels="+encodeURIComponent(a);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:l})}),t(document).on("focus",".ngl-article-excerpt[contenteditable]",function(){let e=t(this);e.data("before",e.html())}).on("blur",".ngl-article-excerpt[contenteditable]",function(){let e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}),t(document).on("change",".ngl-article-excerpt[contenteditable]",function(){var e=t(this).parents(".ngl-article").attr("data-post-id"),a=t(this).html();console.log(a);var l="action=newsletterglue_ajax_update_excerpt&security="+newsletterglue_params.ajaxnonce+"&post_id="+e+"&excerpt="+encodeURIComponent(a);t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:l})}),t(document).on("click",".ngl-article-title a",function(t){return t.preventDefault(),!1}),t(document).on("focus",".ngl-article-title span[contenteditable]",function(){let e=t(this);e.data("before",e.html())}).on("blur",".ngl-article-title span[contenteditable]",function(){let e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}),t(document).on("change",".ngl-article-title span[contenteditable]",function(){var e=t(this).parents(".ngl-articles"),a=t(this).parents(".ngl-article").attr("data-post-id"),l=t(this).parents(".ngl-article").attr("data-key"),n=t(this).html();console.log(n);var i="action=newsletterglue_ajax_update_title&security="+newsletterglue_params.ajaxnonce+"&post_id="+a+"&title="+encodeURIComponent(n);e.find(".ngl-article-list-item[data-key="+l+"] .ngl-article-list-title").html(n),t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:i})});var n="";t(document).on("blur input keyup change",".ngl_article_s",function(){var e=t(this).val(),a=t(this).parents(".ngl-article-add").find(".ngl-article-suggest"),l="action=newsletterglue_ajax_search_articles&security="+newsletterglue_params.ajaxnonce+"&term="+encodeURIComponent(e);return function t(e){let a;try{a=new URL(e)}catch(l){return!1}return"http:"===a.protocol||"https:"===a.protocol}(e)||e.length<3?(a.hide().empty(),n=null,!1):n!=e&&void(n=e,t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:l,success:function(t){t.html?a.show().html(t.html):a.hide().empty()}}))}),t(document).on("click",".ngl-article-suggest li a",function(e){e.preventDefault();var a=t(this).parents(".ngl-article-add"),l=t(this).attr("data-post-id");return a.find(".ngl_article_s").val(t(this).html()).attr("data-post",l),a.find(".ngl-article-suggest").empty().hide(),a.find("button").trigger("click"),!1}),t(document).on("click",".ngl-article-list-head",function(e){e.preventDefault();var a=t(this).parent().find(".ngl-article-list-wrap");return a.is(":visible")?(t(this).find("span").html("expand_less"),a.hide()):(t(this).find("span").html("expand_more"),a.show()),!1}),t(document).on("click",".ngl-article-list-refresh",function(e){e.preventDefault();var a=t(this);t(this).html(),t(this).parents(".ngl-articles");var l=t(this).parents(".ngl-article"),n=t(this).parents(".ngl-articles").attr("data-block-id"),i=l.attr("data-key"),r=l.attr("data-post-id"),s="action=newsletterglue_ajax_clear_cache&security="+newsletterglue_params.ajaxnonce+"&block_id="+n+"&key="+encodeURIComponent(i)+"&thepost="+encodeURIComponent(r);return t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:s,beforeSend:function(){a.addClass("ngl-in-progress ngl-is-toggled"),l.find(".ngl-article-list-link").removeClass("ngl-is-toggled"),l.find(".ngl-article-list-url-edit").removeClass("ngl-show-state"),l.find(".ngl-article-state-refreshing").addClass("ngl-show-state"),l.find(".ngl-article-overlay").show()},success:function(t){a.removeClass("ngl-in-progress").addClass("ngl-in-done"),a.find("i").removeClass().addClass("check icon"),l.find(".ngl-article-state-refreshing").html(newsletterglue_params.refreshed_html).addClass("ngl-refreshed"),setTimeout(function(){l.find(".ngl-article-overlay").hide(),l.find(".ngl-article-state-refreshing").html(newsletterglue_params.refreshing_html).removeClass("ngl-show-state ngl-refreshed"),a.removeClass("ngl-in-done ngl-is-toggled"),a.find("i").removeClass().addClass("sync icon")},1e3),t&&(t.title&&l.find(".ngl-article-title span").html(t.title),t.featured_image&&l.find(".ngl-article-featured img").attr("src",t.featured_image),t.excerpt&&l.find(".ngl-article-excerpt").html(t.excerpt))}}),!1}),t(document).on("click",".ngl-article-overlay",function(e){var a=t(this).parents(".ngl-article"),l=t(this).parents(".ngl-article").find(".ngl-article-state-remove"),n=t(this).parents(".ngl-article").find(".ngl-article-list-url-edit");l.hasClass("ngl-show-state")?a.find(".ngl-article-list-delete").trigger("click"):n.hasClass("ngl-show-state")&&a.find(".ngl-article-list-link").trigger("click")}),t(document).on("click",".ngl-article-state-remove",function(e){if(e.preventDefault(),!t(this).hasClass("ngl-show-state"))return!1;var a=t(this).parents(".ngl-article"),l=t(this).parents(".ngl-articles").attr("data-block-id"),n=a.attr("data-key"),i="action=newsletterglue_ajax_remove_article&security="+newsletterglue_params.ajaxnonce+"&block_id="+l+"&key="+encodeURIComponent(n);return t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:i,beforeSend:function(){a.remove()},success:function(t){}}),!1}),t(document).on("click",".ngl-article-list-move-down a",function(e){e.preventDefault();var l=t(this).parents(".ngl-articles"),n=t(this).parents(".ngl-article");n.attr("data-key");var i=n.next();return 0!==i.length&&(n.insertAfter(i),a(l)),!1}),t(document).on("click",".ngl-article-list-move-up a",function(e){e.preventDefault();var l=t(this).parents(".ngl-articles"),n=t(this).parents(".ngl-article");n.attr("data-key");var i=n.prev();return 0!==i.length&&(n.insertBefore(i),a(l)),!1}),t(document).on("focus",".ngl-article-list-url-edit span[contenteditable]",function(){let e=t(this);e.data("before",e.html())}).on("blur keyup paste input",".ngl-article-list-url-edit span[contenteditable]",function(){let e=t(this);e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change"))}),t(document).on("click",".ngl-article-list-url-edit a",function(e){e.preventDefault(),t(this);var a=t(this).parent().find("span").html(),l=t(this).parents(".ngl-article"),n=t(this).parents(".ngl-articles").attr("data-block-id"),i=l.attr("data-key"),r=t(this).parents(".ngl-articles").attr("data-date_format"),s="action=newsletterglue_ajax_update_url&security="+newsletterglue_params.ajaxnonce+"&block_id="+n+"&key="+encodeURIComponent(i)+"&url="+encodeURIComponent(a)+"&date_format="+encodeURIComponent(r);return t.ajax({type:"post",url:newsletterglue_params.ajaxurl,data:s,beforeSend:function(){},success:function(t){l.find(".ngl-article-overlay").hide(),l.find(".ngl-article-list-url-edit").removeClass("ngl-show-state"),l.find(".ngl-article-list-link").removeClass("ngl-is-toggled"),t.success&&(l.find(".ngl-article-title span").html(t.data.title),l.find(".ngl-article-featured img").attr("src",t.data.featured_image),l.find(".ngl-article-excerpt").html(t.data.excerpt),l.find(".ngl-article-labels").html(t.data.labels),l.find(".ngl-article-date").html(t.data.date),l.attr("data-post-id",t.data.post_id),l.attr("data-key",t.data.key),l.find(".ngl-article-title a").attr("href",t.data.permalink),l.find(".ngl-article-featured a").attr("href",t.data.permalink),l.find(".ngl-article-featured img").attr("data-original-src",t.data.featured_image))},error:function(){}}),!1}),t(document).on("change",".ngl-article-list-url-edit span[contenteditable]",function(){t(this).parent().find("a").show()}),t(document).on("mouseleave",".ngl-article",function(e){t(this).find(".ngl-article-state-remove").hasClass("ngl-show-state")}),t(document).on("click",".ngl-article-list-link",function(e){e.preventDefault();var a=t(this).parents(".ngl-article"),l=a.find(".ngl-article-list-url-edit");return l.hasClass("ngl-show-state")?(a.find(".ngl-article-overlay").hide(),l.removeClass("ngl-show-state"),t(this).removeClass("ngl-is-toggled")):(a.find(".ngl-article-overlay").show(),l.addClass("ngl-show-state"),l.find("span").selectText(),t(this).addClass("ngl-is-toggled")),!1}),t(document).on("click",".ngl-article-list-delete",function(e){e.preventDefault();var a=t(this).parents(".ngl-article"),l=a.find(".ngl-article-state-remove");return l.hasClass("ngl-show-state")?(a.find(".ngl-article-overlay").hide(),l.removeClass("ngl-show-state"),a.find(".ngl-article-list-move, .ngl-article-list-refresh, .ngl-article-list-link").show(),t(this).removeClass("ngl-is-toggled")):(a.find(".ngl-article-overlay").show(),l.addClass("ngl-show-state"),a.find(".ngl-article-list-move, .ngl-article-list-refresh, .ngl-article-list-link").hide(),t(this).addClass("ngl-is-toggled")),!1}),setInterval(function e(){var l=t(".ngl_article_s");if(0==l.length)return!1;l.each(function(){var e=t(this).parents('div[data-type="newsletterglue/article"]').attr("data-block"),l=t(this).parents(".ngl-articles").attr("data-block-id"),n=t(this).parents(".ngl-articles"),i=wp.data.select("core/block-editor").getBlock(e),r=i&&i.attributes.scope?i.attributes.scope:"regular";if(typenow&&"pattern"==r&&"ngl_pattern"!=typenow&&"ngl_template"!=typenow){var s=e.replace(/-/g,"");i.attributes.block_id=s,i.attributes.scope="regular",n.attr("data-block-id",s),wp.data.dispatch("core/block-editor").updateBlock(i.clientId,i.attributes),a(n,l),n.parents('div[data-type="newsletterglue/article"]').find(".ngl-ajax-block-id").html("ID: "+s),n.parents('div[data-type="newsletterglue/article"]').find(".ngl-ajax-block-scope").html("regular")}var c=t(this).parents(".ngl-articles").attr("data-block-id");if(t('.ngl-articles[data-block-id="'+c+'"]').length>1){var d=t('.ngl-articles[data-block-id="'+c+'"]:first'),o=t('.ngl-articles[data-block-id="'+c+'"]:last'),g=o.parents('div[data-type="newsletterglue/article"]').attr("data-block"),u=wp.data.select("core/block-editor").getBlock(g),h=g.replace(/-/g,"");u.attributes.block_id=h,o.attr("data-block-id",h),wp.data.dispatch("core/block-editor").updateBlock(u.clientId,u.attributes),a(o,d.attr("data-block-id")),o.parents('div[data-type="newsletterglue/article"]').find(".ngl-ajax-block-id").html("ID: "+h)}})},100),setInterval(function e(){var a=t(".components-tab-panel__tab-content .editor-block-list-item-newsletterglue-group");a.length&&a.closest(".block-editor-inserter__panel-content").remove(),t(".block-editor-writing-flow [data-block].has-warning").length&&t(".block-editor-writing-flow [data-block].has-warning").each(function(){t(this).find("button.components-button.is-primary").trigger("click")}),t(".ngl-metadata").length&&t(".ngl-metadata").each(function(){var e=t(this).children().last();e.hasClass("ngl-metadata-sep")&&e.hide()}),t.each(["author","group","form","article","callout","metadata","share","columns"],function(e,a){t("button.editor-block-list-item-newsletterglue-"+a).parent().hide(),t('button[id$="-block-newsletterglue/'+a+'"]').hide()})},100)}(jQuery);